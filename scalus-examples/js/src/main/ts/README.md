# Scalus TypeScript/JavaScript Examples

This directory contains examples demonstrating how to use Scalus in Node.js/TypeScript to evaluate
Plutus scripts and Cardano transactions.

## Overview

The example demonstrates two main use cases:

1. **Direct Script Evaluation** - Evaluate a simple UPLC script with data arguments
2. **Transaction Script Evaluation** - Evaluate all Plutus scripts in a Cardano transaction using
   CBOR-encoded transaction and UTxO data

## Prerequisites

- Node.js (v18 or later recommended)
- npm or yarn
- Scalus library built and bundled

## Setup

### 1. Build the Scalus Library

First, you need to build the Scalus JavaScript library from the project root:

```bash
# From the Scalus project root
sbtn scalusCardanoLedgerJS/prepareNpmPackage
```

This command:

- Compiles the Scala.js code to JavaScript
- Optimizes the bundle with Closure Compiler
- Creates `scalus-cardano-ledger-opt-bundle.js` in `scalus-cardano-ledger/js/src/main/npm/`

### 2. Install Dependencies

Navigate to this directory and install dependencies:

```bash
cd scalus-examples/js/src/main/ts
npm install
```

### 3. Update the Bundle Path (if needed)

The `evaluate.ts` file currently uses an absolute path to the Scalus bundle. You may need to update
line 2 in `evaluate.ts`:

```typescript
import {Scalus, SlotConfig} from "scalus";
```

Change it to a relative path or the correct absolute path for your system:

```typescript
const {Scalus, SlotConfig} = require("../../../../../scalus-cardano-ledger/js/src/main/npm/scalus-cardano-ledger-opt-bundle.js");
```

## Running the Examples

### Compile to JavaScript and Run

```bash
npx tsc
node evaluate.js
```

### Expected Output

The script will output:

1. **Script evaluation result**: The result of evaluating a simple script with argument `42`
   ```
   { success: true, budget: { memory: 14100, cpu: 5000000 }, ... }
   14100
   ```

2. **Transaction evaluation results**: An array of redeemers with their execution budgets
   ```
   [
     { tag: 'Spend', index: 0, budget: { memory: ..., cpu: ... } },
     { tag: 'Spend', index: 1, budget: { memory: ..., cpu: ... } }
   ]
   ```

## Files in This Directory

- **`evaluate.ts`** - Main TypeScript example demonstrating Scalus usage
- **`evaluate.js`** - Compiled JavaScript output (generated by `tsc`)
- **`package.json`** - Node.js package configuration
- **`tsconfig.json`** - TypeScript compiler configuration
- **`tx-*.cbor`** - Example CBOR-encoded Cardano transaction
- **`utxo-*.cbor`** - Example CBOR-encoded UTxO set
- **`README.md`** - This file

## API Overview

### Scalus.applyDataArgToScript(script, dataJson)

Applies a data argument to a UPLC script.

- **script**: Hex-encoded UPLC script
- **dataJson**: JSON string representing the Plutus Data argument
- **Returns**: Hex-encoded script with the argument applied

### Scalus.evaluateScript(script)

Evaluates a UPLC script.

- **script**: Hex-encoded UPLC script
- **Returns**: Evaluation result object with `success` flag and `budget` information

### Scalus.evalPlutusScripts(txBytes, utxoBytes, slotConfig)

Evaluates all Plutus scripts in a transaction.

- **txBytes**: Array of bytes representing the CBOR-encoded transaction
- **utxoBytes**: Array of bytes representing the CBOR-encoded UTxO set
- **slotConfig**: Slot configuration (use `SlotConfig.Mainnet`, `SlotConfig.Preprod`, or
  `SlotConfig.Preview`)
- **Returns**: Array of redeemers with computed execution budgets

### SlotConfig

Pre-configured slot configurations for different Cardano networks:

- **`SlotConfig.Mainnet`** - Mainnet configuration
- **`SlotConfig.Preview`** - Preview testnet configuration
- **`SlotConfig.Preprod`** - Pre-production testnet configuration

## Notes

- **Node.js Only**: This example uses Node.js file system APIs (`fs`) and is not compatible with
  browser environments
- **CBOR Files**: The example CBOR files contain real Cardano mainnet transaction data
- **Performance**: The first evaluation may take longer as the JavaScript runtime warms up
- **Memory**: Large transactions may require increased Node.js heap size:
  `node --max-old-space-size=4096 evaluate.js`

## TypeScript Type Definitions

For TypeScript development, type definitions are available in:

```
scalus-cardano-ledger/js/src/main/npm/scalus.d.ts
```

You can copy this file to your project or reference it in your `tsconfig.json`:

```json
{
  "compilerOptions": {
    "typeRoots": [
      "./node_modules/@types",
      "../../../scalus-cardano-ledger/js/src/main/npm"
    ]
  }
}
```

## Troubleshooting

### Error: Cannot find module 'scalus-cardano-ledger-opt-bundle.js'

Make sure you've run `sbtn scalusCardanoLedgerJS/prepareNpmPackage` and updated the path in
`evaluate.ts`.

### Error: Cannot read property 'evalPlutusScripts' of undefined

Ensure the Scalus bundle is built with the latest changes. Rebuild with:

```bash
sbtn clean scalusCardanoLedgerJS/prepareNpmPackage
```
